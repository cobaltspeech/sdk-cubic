<!DOCTYPE html>
<html>
  <head>
    <title>Cubic SDK -- Cobalt</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Streaming Recognition :: Cubic SDK -- Cobalt</title>
<link rel="shortcut icon" href="../../images/favicon.ico" type="image/x-icon" />
<link href="../../css/nucleus.css" rel="stylesheet">
<link href="../../css/font-awesome.min.css" rel="stylesheet">
<link href="../../css/hybrid.css" rel="stylesheet">
<link href="../../css/featherlight.min.css" rel="stylesheet">
<link href="../../css/auto-complete.css" rel="stylesheet">
<link href="../../theme-original/style.css" rel="stylesheet">

  <link href="../../theme-original/variant-blue.css" rel="stylesheet">

<link rel="stylesheet" href="../../css/bootstrap.min.css">
<script src="../../js/jquery-2.x.min.js"></script>
<style type="text/css">
  :root #header + #content > #left > #rlblock_left {
    display:none !important;
  }
</style>
<link href="../../css/tabs.css" rel="stylesheet" type="text/css">
<script src="../../js/tabs.js"></script>


    
  </head>
  <body data-url="/using-cubic-sdk/streaming/">
    
      <div id="headermain"></div>
<nav id="sidebar" class="showVisitedLinks">



<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      
	
  
    <p><img src="../../sdk-cubic/images/logo-white.png" alt="Cobalt&rsquo;s SDK Documentation"></p>
<p>Cubic SDK &ndash; Cobalt</p>

  


    </div>
        <div class="searchbox">
		    <label for="search-by"><i class="fa fa-search"></i></label>
		    <input data-search-input id="search-by" type="text" placeholder="Search...">
		    <span data-search-clear=""><i class="fa fa-close"></i></span>
		</div>
		<script type="text/javascript" src="../../js/lunr.min.js"></script>
		<script type="text/javascript" src="../../js/auto-complete.js"></script>
		<script type="text/javascript">
        
            var baseurl = "";
        
		</script>
		<script type="text/javascript" src="../../js/search.js"></script>
  </div>

      <ul class="topics">
            <li data-nav-id="/" class="dd-item">
            <a href="../../"><i class="fa fa-fw fa-home"></i></a>
            </li>
    <li data-nav-id="/getting-started/" class="dd-item
        ">
      <div>
      <a href="../../getting-started/">Server Setup</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/using-cubic-sdk/" class="dd-item parent haschildren
        ">
      <div>
      <a href="../../using-cubic-sdk/">Using Cubic-SDK</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/using-cubic-sdk/installation/" class="dd-item">
        <div>
          <a href="../../using-cubic-sdk/installation/">
            Installing the SDK
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/using-cubic-sdk/connecting/" class="dd-item">
        <div>
          <a href="../../using-cubic-sdk/connecting/">
            Setup Connection
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/using-cubic-sdk/recognize/" class="dd-item">
        <div>
          <a href="../../using-cubic-sdk/recognize/">
            Synchronous Recognition
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/using-cubic-sdk/streaming/" class="dd-item active">
        <div>
          <a href="../../using-cubic-sdk/streaming/">
            Streaming Recognition
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/using-cubic-sdk/recognition-context/" class="dd-item">
        <div>
          <a href="../../using-cubic-sdk/recognition-context/">
            Recognition Context
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/using-cubic-sdk/client-configs/" class="dd-item">
        <div>
          <a href="../../using-cubic-sdk/client-configs/">
            Recognition Configurations
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/using-cubic-sdk/android/" class="dd-item">
        <div>
          <a href="../../using-cubic-sdk/android/">
            Android Integrations
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/protobuf/" class="dd-item haschildren
        ">
      <div>
      <a href="../../protobuf/">Cubic API Reference</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/protobuf/autogen-doc-cubic-proto/" class="dd-item">
        <div>
          <a href="../../protobuf/autogen-doc-cubic-proto/">
            Cubic Protobuf API Docs
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>



        <section id="shortcuts">
                <li class="" role=""><h3>More</h3><a href="https://github.com/cobaltspeech/sdk-cubic" target="_blank" rel="noopener"><i class='fa fa-github'></i> <label>Github repo</label></a></li>
                <li class="" role=""><a href="https://www.cobaltspeech.com/contact" target="_blank" rel="noopener"><i class='fa fa-bookmark'></i> <label>Contact us</label></a></li>
        </section>
            <a id="clear-history" class="" href="#" data-clear-history-toggle=""><i class="fa  fa-history"></i> Clear History</a>

    <hr />
    <li></li>
    
    </ul>

 <section id="footer">
    </section>
  </div>
</nav>



<section id="body">
<div id="overlay"></div>
<div class="padding highlightable">

  <div id="top-bar">
    <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
        <span id="sidebar-toggle-span">
          <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
            <i class="fa fa-bars"></i>
          </a>
        </span>
        <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
        <span class="links">
        







 <a href='../../'>Cubic SDK Documentation</a> > <a href='../../using-cubic-sdk/'>Using Cubic-SDK</a> > Streaming Recognition

 

 

   
        </span>
    </div>
    
    
    <div class="progress">
        <div class="wrapper">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#streaming-from-an-audio-file">Streaming from an audio file</a></li>
        <li><a href="#streaming-from-microphone">Streaming from microphone</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
    </div>
    

  </div>


<div id="body-inner">
  
    <h1>Streaming Recognition</h1>
  



    
    
    
    <p>The following example shows how to transcribe an audio file using Cubicâ€™s
Streaming Recognize Request. The stream can come from a file on disk or be
directly from a microphone in real time.</p>
<h3 id="streaming-from-an-audio-file">Streaming from an audio file</h3>
<p>We support several file formats including WAV, MP3, FLAC etc. For more details, please
see the protocol buffer specification file in the SDK repository (<code>grpc/cubic.proto</code>).
The examples below use a WAV file as input to the streaming recognition. We will query
the server for available models and use the first model to transcribe the speech.</p>
<div class='code-tabs'><ul class="nav-tabs"></ul><div class="tab-content">
<div class="tab-pane" title="Go">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">
<span style="color:#6ab825;font-weight:bold">package</span> main

<span style="color:#6ab825;font-weight:bold">import</span> (
	<span style="color:#ed9d13">&#34;context&#34;</span>
	<span style="color:#ed9d13">&#34;fmt&#34;</span>
	<span style="color:#ed9d13">&#34;log&#34;</span>
	<span style="color:#ed9d13">&#34;os&#34;</span>

	<span style="color:#ed9d13">&#34;github.com/cobaltspeech/sdk-cubic/grpc/go-cubic&#34;</span>
	<span style="color:#ed9d13">&#34;github.com/cobaltspeech/sdk-cubic/grpc/go-cubic/cubicpb&#34;</span>
)

<span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">main</span>() {

    <span style="color:#999;font-style:italic">// Creating client without TLS. Remove cubic.WithInsecure() if using TLS
</span><span style="color:#999;font-style:italic"></span>    serverAddr := <span style="color:#ed9d13">&#34;127.0.0.1:2727&#34;</span>
	client, err := cubic.<span style="color:#447fcf">NewClient</span>(serverAddr, cubic.<span style="color:#447fcf">WithInsecure</span>())
	<span style="color:#6ab825;font-weight:bold">if</span> err != <span style="color:#6ab825;font-weight:bold">nil</span> {
		log.<span style="color:#447fcf">Fatal</span>(err)
	}
	<span style="color:#6ab825;font-weight:bold">defer</span> client.<span style="color:#447fcf">Close</span>()

	modelResp, err := client.<span style="color:#447fcf">ListModels</span>(context.<span style="color:#447fcf">Background</span>())
	<span style="color:#6ab825;font-weight:bold">if</span> err != <span style="color:#6ab825;font-weight:bold">nil</span> {
		log.<span style="color:#447fcf">Fatal</span>(err)
	}

	<span style="color:#999;font-style:italic">// Use the first available model
</span><span style="color:#999;font-style:italic"></span>	model := modelResp.Models[<span style="color:#3677a9">0</span>]

	f, err := os.<span style="color:#447fcf">Open</span>(<span style="color:#ed9d13">&#34;test.wav&#34;</span>)
	<span style="color:#6ab825;font-weight:bold">if</span> err != <span style="color:#6ab825;font-weight:bold">nil</span> {
		log.<span style="color:#447fcf">Fatal</span>(err)
	}

	<span style="color:#6ab825;font-weight:bold">defer</span> f.<span style="color:#447fcf">Close</span>()

	cfg := &amp;cubicpb.RecognitionConfig{
		ModelId: model.Id,
	}

	<span style="color:#999;font-style:italic">// Define a callback function to handle results
</span><span style="color:#999;font-style:italic"></span>	resultHandler := <span style="color:#6ab825;font-weight:bold">func</span>(resp *cubicpb.RecognitionResponse) {
		<span style="color:#6ab825;font-weight:bold">for</span> _, r := <span style="color:#6ab825;font-weight:bold">range</span> resp.Results {
			<span style="color:#6ab825;font-weight:bold">if</span> !r.IsPartial {
				fmt.<span style="color:#447fcf">Println</span>(r.Alternatives[<span style="color:#3677a9">0</span>].Transcript)
			}
		}
	}

	err = client.<span style="color:#447fcf">StreamingRecognize</span>(context.<span style="color:#447fcf">Background</span>(), cfg, f, resultHandler)
	<span style="color:#6ab825;font-weight:bold">if</span> err != <span style="color:#6ab825;font-weight:bold">nil</span> {
		log.<span style="color:#447fcf">Fatal</span>(err)
	}

}
</code></pre></div>
</div>


<div class="tab-pane" title="Python">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">cubic</span>

<span style="color:#999;font-style:italic"># set insecure to False if server uses TLS</span>
serverAddress = <span style="color:#ed9d13">&#39;127.0.0.1:2727&#39;</span>
client = cubic.Client(serverAddress, insecure=True)

<span style="color:#999;font-style:italic"># get list of available models</span>
modelResp = client.ListModels()
<span style="color:#6ab825;font-weight:bold">for</span> model <span style="color:#6ab825;font-weight:bold">in</span> modelResp.models:
    <span style="color:#6ab825;font-weight:bold">print</span>(<span style="color:#ed9d13">&#34;ID = {}, Name = {}&#34;</span>.format(model.id, model.name))

<span style="color:#999;font-style:italic"># use the first available model</span>
model = modelResp.models[<span style="color:#3677a9">0</span>]

cfg = cubic.RecognitionConfig(
    model_id = model.id
)

<span style="color:#999;font-style:italic"># client.StreamingRecognize takes any binary stream object that</span>
<span style="color:#999;font-style:italic"># has a read(nBytes) method. The method should return nBytes from</span>
<span style="color:#999;font-style:italic"># the stream.</span>

<span style="color:#999;font-style:italic"># open audio file stream</span>
audio = <span style="color:#24909d">open</span>(<span style="color:#ed9d13">&#39;test.wav&#39;</span>, <span style="color:#ed9d13">&#39;rb&#39;</span>)

<span style="color:#999;font-style:italic"># send streaming request to cubic and print out results as they come in</span>
<span style="color:#6ab825;font-weight:bold">for</span> resp <span style="color:#6ab825;font-weight:bold">in</span> client.StreamingRecognize(cfg, audio):
    <span style="color:#6ab825;font-weight:bold">for</span> result <span style="color:#6ab825;font-weight:bold">in</span> resp.results:
        <span style="color:#6ab825;font-weight:bold">if</span> result.is_partial:
            <span style="color:#6ab825;font-weight:bold">print</span>(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">\r</span><span style="color:#ed9d13">{0}&#34;</span>.format(result.alternatives[<span style="color:#3677a9">0</span>].transcript), end=<span style="color:#ed9d13">&#34;&#34;</span>)
        <span style="color:#6ab825;font-weight:bold">else</span>:
            <span style="color:#6ab825;font-weight:bold">print</span>(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">\r</span><span style="color:#ed9d13">{0}&#34;</span>.format(result.alternatives[<span style="color:#3677a9">0</span>].transcript), end=<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">\n</span><span style="color:#ed9d13">&#34;</span>)
</code></pre></div>
</div>


<div class="tab-pane" title="C#">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c#" data-lang="c#">
<span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">System</span>;
<span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">System.Collections.Generic</span>;
<span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">System.IO</span>;
<span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">System.Linq</span>;
<span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">System.Threading.Tasks</span>;
<span style="color:#6ab825;font-weight:bold">using</span> <span style="color:#447fcf;text-decoration:underline">Grpc.Core</span>;

<span style="color:#6ab825;font-weight:bold">namespace</span> <span style="color:#447fcf;text-decoration:underline">CubicStreamingRecognitionExample</span> {
    <span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">Program</span> {
        <span style="color:#6ab825;font-weight:bold">static</span> <span style="color:#6ab825;font-weight:bold">async</span> Task Main(<span style="color:#6ab825;font-weight:bold">string</span>[] args) {

            <span style="color:#999;font-style:italic">// set creds = new Grpc.Core.SslCredentials(); if using TLS
</span><span style="color:#999;font-style:italic"></span>            <span style="color:#6ab825;font-weight:bold">var</span> serverAddress = <span style="color:#ed9d13">&#34;127.0.0.1:2727&#34;</span>;
            <span style="color:#6ab825;font-weight:bold">var</span> creds = Grpc.Core.ChannelCredentials.Insecure;

            <span style="color:#999;font-style:italic">// Initialize a gRPC connection
</span><span style="color:#999;font-style:italic"></span>            <span style="color:#6ab825;font-weight:bold">var</span> channel = <span style="color:#6ab825;font-weight:bold">new</span> Grpc.Core.Channel(serverAddress, creds);
            <span style="color:#6ab825;font-weight:bold">var</span> client = <span style="color:#6ab825;font-weight:bold">new</span> CobaltSpeech.Cubic.Cubic.CubicClient(channel);

            <span style="color:#999;font-style:italic">// List the available models
</span><span style="color:#999;font-style:italic"></span>            <span style="color:#6ab825;font-weight:bold">var</span> listModelsRequest = <span style="color:#6ab825;font-weight:bold">new</span> CobaltSpeech.Cubic.ListModelsRequest();
            <span style="color:#6ab825;font-weight:bold">var</span> modelResp = client.ListModels(listModelsRequest);

            <span style="color:#999;font-style:italic">// Using first model available
</span><span style="color:#999;font-style:italic"></span>            <span style="color:#6ab825;font-weight:bold">var</span> model = modelResp.Models[<span style="color:#3677a9">0</span>];

            <span style="color:#999;font-style:italic">// Setup Recognition Config
</span><span style="color:#999;font-style:italic"></span>            <span style="color:#6ab825;font-weight:bold">var</span> cfg = <span style="color:#6ab825;font-weight:bold">new</span> CobaltSpeech.Cubic.RecognitionConfig {
                ModelId = model.Id,
                AudioEncoding = CobaltSpeech.Cubic.RecognitionConfig.Types.Encoding.Wav,
            };

            <span style="color:#6ab825;font-weight:bold">string</span> audioPath = <span style="color:#ed9d13">&#34;test.wav&#34;</span>;

            <span style="color:#999;font-style:italic">// Setup the bi-directional gRPC stream.
</span><span style="color:#999;font-style:italic"></span>            <span style="color:#6ab825;font-weight:bold">var</span> call = client.StreamingRecognize();
            using(call) {
                <span style="color:#999;font-style:italic">// Setup recieve task
</span><span style="color:#999;font-style:italic"></span>                <span style="color:#6ab825;font-weight:bold">var</span> responseReaderTask = Task.Run(<span style="color:#6ab825;font-weight:bold">async</span>() =&gt; {
                    <span style="color:#999;font-style:italic">// Wait for the next response
</span><span style="color:#999;font-style:italic"></span>                    <span style="color:#6ab825;font-weight:bold">while</span> (<span style="color:#6ab825;font-weight:bold">await</span> call.ResponseStream.MoveNext()) {
                        <span style="color:#6ab825;font-weight:bold">var</span> response = call.ResponseStream.Current;
                        <span style="color:#6ab825;font-weight:bold">foreach</span> (<span style="color:#6ab825;font-weight:bold">var</span> result <span style="color:#6ab825;font-weight:bold">in</span> response.Results) {
                            Console.WriteLine(result.Alternatives[<span style="color:#3677a9">0</span>].Transcript);
                        }
                    }
                });

                <span style="color:#999;font-style:italic">// Send config first, followed by the audio
</span><span style="color:#999;font-style:italic"></span>                {
                    <span style="color:#999;font-style:italic">// Send the configs
</span><span style="color:#999;font-style:italic"></span>                    <span style="color:#6ab825;font-weight:bold">var</span> request = <span style="color:#6ab825;font-weight:bold">new</span> CobaltSpeech.Cubic.StreamingRecognizeRequest();
                    request.Config = cfg;
                    <span style="color:#6ab825;font-weight:bold">await</span> call.RequestStream.WriteAsync(request);

                    <span style="color:#999;font-style:italic">// Setup object for streaming audio
</span><span style="color:#999;font-style:italic"></span>                    request.Config = <span style="color:#6ab825;font-weight:bold">null</span>;
                    request.Audio = <span style="color:#6ab825;font-weight:bold">new</span> CobaltSpeech.Cubic.RecognitionAudio { };

                    <span style="color:#999;font-style:italic">// Send the audio, in 8kb chunks
</span><span style="color:#999;font-style:italic"></span>                    <span style="color:#6ab825;font-weight:bold">const</span> <span style="color:#6ab825;font-weight:bold">int</span> chunkSize = <span style="color:#3677a9">8192</span>;
                    using(FileStream file = File.OpenRead(audioPath)) {
                        <span style="color:#6ab825;font-weight:bold">int</span> bytesRead;
                        <span style="color:#6ab825;font-weight:bold">var</span> buffer = <span style="color:#6ab825;font-weight:bold">new</span> <span style="color:#6ab825;font-weight:bold">byte</span>[chunkSize];
                        <span style="color:#6ab825;font-weight:bold">while</span> ((bytesRead = file.Read(buffer, <span style="color:#3677a9">0</span>, buffer.Length)) &gt; <span style="color:#3677a9">0</span>) {
                            <span style="color:#6ab825;font-weight:bold">var</span> bytes = Google.Protobuf.ByteString.CopyFrom(buffer.Take(bytesRead).ToArray());
                            request.Audio.Data = bytes;
                            <span style="color:#6ab825;font-weight:bold">await</span> call.RequestStream.WriteAsync(request);
                        }

                        <span style="color:#999;font-style:italic">// Close the sending stream
</span><span style="color:#999;font-style:italic"></span>                        <span style="color:#6ab825;font-weight:bold">await</span> call.RequestStream.CompleteAsync();
                    }
                }

                <span style="color:#999;font-style:italic">// Wait for all of the responses to come back through the receiving stream
</span><span style="color:#999;font-style:italic"></span>                <span style="color:#6ab825;font-weight:bold">await</span> responseReaderTask;
            }
        }
    }
}
</code></pre></div>
</div>


<div class="tab-pane" title="Java/Android">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
<span style="color:#999;font-style:italic">/*
</span><span style="color:#999;font-style:italic">  Please note: this example does not attempt to handle threading and all exceptions.
</span><span style="color:#999;font-style:italic">  It gives a simplified overview of the essential gRPC calls.
</span><span style="color:#999;font-style:italic">*/</span>

<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">io.grpc.ManagedChannel</span>;
<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">io.grpc.ManagedChannelBuilder</span>;
<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">io.grpc.stub.StreamObserver</span>;

<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">com.google.protobuf.ByteString</span>;

<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">com.cobaltspeech.cubic.CubicGrpc</span>;
<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">com.cobaltspeech.cubic.CubicOuterClass.*</span>;

<span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">static</span> <span style="color:#6ab825;font-weight:bold">void</span> <span style="color:#447fcf">transcribeFile</span>() {
    <span style="color:#999;font-style:italic">// Setup connection
</span><span style="color:#999;font-style:italic"></span>    CubicGrpc.<span style="color:#bbb">CubicStub</span> mCubicService = CubicGrpc.<span style="color:#bbb">newStub</span>(
        ManagedChannelBuilder.<span style="color:#bbb">forTarget</span>(url).<span style="color:#bbb">build</span>());

    <span style="color:#999;font-style:italic">// Setup callback to handle results
</span><span style="color:#999;font-style:italic"></span>    StreamObserver&lt;&gt; responseObserver = <span style="color:#6ab825;font-weight:bold">new</span> StreamObserver&lt;RecognitionResponse&gt;() {
        <span style="color:#ffa500">@Override</span>
        <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">void</span> <span style="color:#447fcf">onNext</span>(RecognitionResponse value) {
            System.<span style="color:#bbb">out</span>.<span style="color:#bbb">println</span>(<span style="color:#ed9d13">&#34;Result: &#34;</span> + value.<span style="color:#bbb">toString</span>());
        }

        <span style="color:#ffa500">@Override</span>
        <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">void</span> <span style="color:#447fcf">onError</span>(Throwable t) {
            System.<span style="color:#bbb">err</span>.<span style="color:#bbb">println</span>(<span style="color:#ed9d13">&#34;Error with recognition:&#34;</span> + t.<span style="color:#bbb">toString</span>());
        }

        <span style="color:#ffa500">@Override</span>
        <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">void</span> <span style="color:#447fcf">onCompleted</span>() {
            System.<span style="color:#bbb">out</span>.<span style="color:#bbb">println</span>(<span style="color:#ed9d13">&#34;Server is done sending responses back&#34;</span>);
        }
    };

    <span style="color:#999;font-style:italic">// Setup bidirectional stream
</span><span style="color:#999;font-style:italic"></span>    StreamObserver&lt;StreamingRecognizeRequest&gt; requestObserver; <span style="color:#999;font-style:italic">// Outgoing messages are sent on this request object
</span><span style="color:#999;font-style:italic"></span>    requestObserver = mCubicService.<span style="color:#bbb">streamingRecognize</span>(mRecognitionResponseObserver);

    <span style="color:#999;font-style:italic">// Send config message
</span><span style="color:#999;font-style:italic"></span>    StreamingRecognizeRequest configs = StreamingRecognizeRequest.<span style="color:#bbb">newBuilder</span>()
        <span style="color:#999;font-style:italic">// Note, we do not call setAudio here.
</span><span style="color:#999;font-style:italic"></span>        .<span style="color:#bbb">setConfig</span>(RecognitionConfig.<span style="color:#bbb">newBuilder</span>()
            .<span style="color:#bbb">setModelId</span>(<span style="color:#ed9d13">&#34;ModelID&#34;</span>)
            .<span style="color:#bbb">build</span>())
        .<span style="color:#bbb">build</span>();
    requestObserver.<span style="color:#bbb">onNext</span>(configs);

    <span style="color:#999;font-style:italic">// Read the file in chunks and stream to server.
</span><span style="color:#999;font-style:italic"></span>    <span style="color:#6ab825;font-weight:bold">try</span> {
        FileInputStream is = <span style="color:#6ab825;font-weight:bold">new</span> FileInputStream(<span style="color:#6ab825;font-weight:bold">new</span> File(<span style="color:#ed9d13">&#34;/path/to/file&#34;</span>));
        <span style="color:#6ab825;font-weight:bold">byte</span>[] bytes = <span style="color:#6ab825;font-weight:bold">new</span> <span style="color:#6ab825;font-weight:bold">byte</span>[1024];
        <span style="color:#6ab825;font-weight:bold">int</span> len = 0;

        <span style="color:#999;font-style:italic">// Read the file
</span><span style="color:#999;font-style:italic"></span>        <span style="color:#6ab825;font-weight:bold">while</span> ((len = is.<span style="color:#bbb">read</span>(chunk)) != -1) {
            <span style="color:#999;font-style:italic">// Convert byte[] to ByteString for gRPC
</span><span style="color:#999;font-style:italic"></span>            ByteString audioBS = ByteString.<span style="color:#bbb">copyFrom</span>(chunk);

            <span style="color:#999;font-style:italic">// Send audio to server
</span><span style="color:#999;font-style:italic"></span>            RecognitionAudio audioMsg = RecognitionAudio.<span style="color:#bbb">newBuilder</span>()
                .<span style="color:#bbb">setData</span>(audioBS)
                .<span style="color:#bbb">build</span>()
            requestObserver.<span style="color:#bbb">onNext</span>(StreamingRecognizeRequest.<span style="color:#bbb">newBuilder</span>()
                .<span style="color:#bbb">setAudio</span>(audioMsg)
                .<span style="color:#bbb">build</span>());
        }
    } <span style="color:#6ab825;font-weight:bold">catch</span> (Exception e) { } <span style="color:#999;font-style:italic">// Handle exception
</span><span style="color:#999;font-style:italic"></span>
    <span style="color:#999;font-style:italic">// Close the client side stream
</span><span style="color:#999;font-style:italic"></span>    requestObserver.<span style="color:#bbb">onCompleted</span>();

    <span style="color:#999;font-style:italic">// Note: Once the server is done transcribing everything, responseObserver.onCompleted() will be called.
</span><span style="color:#999;font-style:italic"></span>}
</code></pre></div>
</div>


<div class="tab-pane" title="Swift/iOS">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift">
<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">Foundation</span>
<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">Cubic</span>

<span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">CubicExample</span> {

    <span style="color:#999;font-style:italic">// set useTLS to true if using TLS</span>
    <span style="color:#6ab825;font-weight:bold">let</span> <span style="color:#40ffff">client</span> = Client(host: <span style="color:#ed9d13">&#34;127.0.0.1&#34;</span>, port: <span style="color:#3677a9">2727</span>, useTLS: <span style="color:#6ab825;font-weight:bold">false</span>)
    <span style="color:#6ab825;font-weight:bold">var</span> <span style="color:#40ffff">config</span> = Cobaltspeech_Cubic_RecognitionConfig()
    <span style="color:#6ab825;font-weight:bold">let</span> <span style="color:#40ffff">fileName</span> = <span style="color:#ed9d13">&#34;test.wav&#34;</span>
    <span style="color:#6ab825;font-weight:bold">let</span> <span style="color:#40ffff">chunkSize</span> = <span style="color:#3677a9">8192</span>
    
    <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">init</span>() {
        <span style="color:#6ab825;font-weight:bold">let</span> <span style="color:#40ffff">fileUrl</span> = URL(fileURLWithPath: fileName)
        
        <span style="color:#6ab825;font-weight:bold">guard</span> <span style="color:#6ab825;font-weight:bold">let</span> <span style="color:#40ffff">audioData</span> = <span style="color:#6ab825;font-weight:bold">try</span>? Data(contentsOf: fileUrl) <span style="color:#6ab825;font-weight:bold">else</span> { <span style="color:#6ab825;font-weight:bold">return</span> }
        
        config.audioEncoding = .wav
        
        client.listModels(success: { (models) <span style="color:#6ab825;font-weight:bold">in</span>
            <span style="color:#6ab825;font-weight:bold">if</span> <span style="color:#6ab825;font-weight:bold">let</span> <span style="color:#40ffff">model</span> = models?.first {
                <span style="color:#6ab825;font-weight:bold">self</span>.config.modelID = model.id
                
                <span style="color:#6ab825;font-weight:bold">self</span>.client.streamingRecognize(audioData: audioData, chunkSize: <span style="color:#6ab825;font-weight:bold">self</span>.chunkSize, config: <span style="color:#6ab825;font-weight:bold">self</span>.config, success: { (response) <span style="color:#6ab825;font-weight:bold">in</span>
                    <span style="color:#6ab825;font-weight:bold">for</span> result <span style="color:#6ab825;font-weight:bold">in</span> response.results {
                        <span style="color:#6ab825;font-weight:bold">if</span> !result.isPartial, <span style="color:#6ab825;font-weight:bold">let</span> <span style="color:#40ffff">alternative</span> = result.alternatives.first {
                            print(alternative.transcript)
                        }
                    }
                }) { (error) <span style="color:#6ab825;font-weight:bold">in</span>
                    print(error.localizedDescription)
                }
            }
        }) { (error) <span style="color:#6ab825;font-weight:bold">in</span>
            print(error.localizedDescription)
        }
    }

}
</code></pre></div>
</div>


</div></div>

<h3 id="streaming-from-microphone">Streaming from microphone</h3>
<p>Streaming audio from microphone input typically needs us to interact with system
libraries. There are several options available, and although the examples here use
one, you may choose to use an alternative as long as the recording audio format is
chosen correctly.</p>
<div class='code-tabs'><ul class="nav-tabs"></ul><div class="tab-content">
<div class="tab-pane" title="Go">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">

<span style="color:#999;font-style:italic">/*
</span><span style="color:#999;font-style:italic">This example utilizes the portaudio bindings for Go (see https://github.com/gordonklaus/portaudio)
</span><span style="color:#999;font-style:italic">to stream audio from a microphone. To use this package, install PortAudio (see http://www.portaudio.com/)
</span><span style="color:#999;font-style:italic">development headers and libraries using an appropriate package manager for your system (e.g. `apt-get install portaudio19-dev` on Ubuntu, `brew install portaudio` for OSX, etc.) or build from [source](http://portaudio.com/docs/v19-doxydocs/tutorial_start.html).
</span><span style="color:#999;font-style:italic">
</span><span style="color:#999;font-style:italic">*/</span>

<span style="color:#6ab825;font-weight:bold">package</span> main

<span style="color:#6ab825;font-weight:bold">import</span> (
	<span style="color:#ed9d13">&#34;bytes&#34;</span>
	<span style="color:#ed9d13">&#34;context&#34;</span>
	<span style="color:#ed9d13">&#34;encoding/binary&#34;</span>
	<span style="color:#ed9d13">&#34;fmt&#34;</span>
	<span style="color:#ed9d13">&#34;log&#34;</span>

	<span style="color:#ed9d13">&#34;github.com/cobaltspeech/sdk-cubic/grpc/go-cubic&#34;</span>
	<span style="color:#ed9d13">&#34;github.com/cobaltspeech/sdk-cubic/grpc/go-cubic/cubicpb&#34;</span>
	<span style="color:#ed9d13">&#34;github.com/gordonklaus/portaudio&#34;</span>
)

<span style="color:#6ab825;font-weight:bold">const</span> serverAddr = <span style="color:#ed9d13">&#34;127.0.0.1:2727&#34;</span>

<span style="color:#999;font-style:italic">// Microphone implements the io.ReadCloser interface and provides
</span><span style="color:#999;font-style:italic">// a data stream for microphone input.
</span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">type</span> Microphone <span style="color:#6ab825;font-weight:bold">struct</span> {
	buffer []<span style="color:#6ab825;font-weight:bold">int16</span>
	stream *portaudio.Stream
}

<span style="color:#999;font-style:italic">// NewMicrophone instantiates a Microphone object with the desired
</span><span style="color:#999;font-style:italic">// sampling rate and buffer size. When streaming to cubic, the sample
</span><span style="color:#999;font-style:italic">// rate should be set to the sample rate of the model used.
</span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">NewMicrophone</span>(sampleRate, bufferSize <span style="color:#6ab825;font-weight:bold">uint32</span>) (*Microphone, <span style="color:#6ab825;font-weight:bold">error</span>) {

	<span style="color:#999;font-style:italic">// bufferSize is measured in number of bytes. Since we are capturing
</span><span style="color:#999;font-style:italic"></span>	<span style="color:#999;font-style:italic">// 16 bit audio, each sample is 2 bytes. The microphone has a int16
</span><span style="color:#999;font-style:italic"></span>	<span style="color:#999;font-style:italic">// buffer, so we use the number of samples as its size.
</span><span style="color:#999;font-style:italic"></span>	numSamples := bufferSize/<span style="color:#3677a9">2</span>
	mic := Microphone{buffer: <span style="color:#24909d">make</span>([]<span style="color:#6ab825;font-weight:bold">int16</span>, numSamples)}

	portaudio.<span style="color:#447fcf">Initialize</span>()
	stream, err := portaudio.<span style="color:#447fcf">OpenDefaultStream</span>(<span style="color:#3677a9">1</span>, <span style="color:#3677a9">0</span>, <span style="color:#24909d">float64</span>(sampleRate), <span style="color:#24909d">int</span>(numSamples), mic.buffer)
	<span style="color:#6ab825;font-weight:bold">if</span> err != <span style="color:#6ab825;font-weight:bold">nil</span> {
		<span style="color:#6ab825;font-weight:bold">return</span> <span style="color:#6ab825;font-weight:bold">nil</span>, err
	}
	mic.stream = stream

	err = mic.stream.<span style="color:#447fcf">Start</span>()
	<span style="color:#6ab825;font-weight:bold">if</span> err != <span style="color:#6ab825;font-weight:bold">nil</span> {
		<span style="color:#6ab825;font-weight:bold">return</span> <span style="color:#6ab825;font-weight:bold">nil</span>, err
	}

	<span style="color:#6ab825;font-weight:bold">return</span> &amp;mic, <span style="color:#6ab825;font-weight:bold">nil</span>
}

<span style="color:#999;font-style:italic">// Read copies N bytes into the passed buffer from the microphone audio buffer
</span><span style="color:#999;font-style:italic">// where N is the buffer size passed to `cubic.NewClient`. Also, to be compatible
</span><span style="color:#999;font-style:italic">// with the cubic client, it returns two things : an int representing the number of
</span><span style="color:#999;font-style:italic">// bytes copied and an error.
</span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">func</span> (mic *Microphone) <span style="color:#447fcf">Read</span>(buffer []<span style="color:#6ab825;font-weight:bold">byte</span>) (<span style="color:#6ab825;font-weight:bold">int</span>, <span style="color:#6ab825;font-weight:bold">error</span>) {
	err := mic.stream.<span style="color:#447fcf">Read</span>()
	<span style="color:#6ab825;font-weight:bold">if</span> err != <span style="color:#6ab825;font-weight:bold">nil</span> {
		<span style="color:#6ab825;font-weight:bold">return</span> <span style="color:#3677a9">0</span>, err
	}
	byteBuffer := <span style="color:#24909d">new</span>(bytes.Buffer)
	err = binary.<span style="color:#447fcf">Write</span>(byteBuffer, binary.LittleEndian, mic.buffer)
	<span style="color:#6ab825;font-weight:bold">if</span> err != <span style="color:#6ab825;font-weight:bold">nil</span> {
		<span style="color:#6ab825;font-weight:bold">return</span> <span style="color:#3677a9">0</span>, err
	}
	<span style="color:#24909d">copy</span>(buffer, byteBuffer.<span style="color:#447fcf">Bytes</span>())
	<span style="color:#6ab825;font-weight:bold">return</span> <span style="color:#24909d">len</span>(buffer), <span style="color:#6ab825;font-weight:bold">nil</span>
}

<span style="color:#999;font-style:italic">// Close shuts the microphone stream down and cleans up
</span><span style="color:#999;font-style:italic"></span><span style="color:#6ab825;font-weight:bold">func</span> (mic *Microphone) <span style="color:#447fcf">Close</span>() {
	mic.stream.<span style="color:#447fcf">Stop</span>()
	mic.stream.<span style="color:#447fcf">Close</span>()
	portaudio.<span style="color:#447fcf">Terminate</span>()
}

<span style="color:#6ab825;font-weight:bold">func</span> <span style="color:#447fcf">main</span>() {

    bufferSize := <span style="color:#24909d">uint32</span>(<span style="color:#3677a9">8192</span>)

    <span style="color:#999;font-style:italic">// Creating client without TLS. Remove cubic.WithInsecure() if using TLS
</span><span style="color:#999;font-style:italic"></span>	client, err := cubic.<span style="color:#447fcf">NewClient</span>(serverAddr, cubic.<span style="color:#447fcf">WithInsecure</span>(), cubic.<span style="color:#447fcf">WithStreamingBufferSize</span>(bufferSize))
	<span style="color:#6ab825;font-weight:bold">if</span> err != <span style="color:#6ab825;font-weight:bold">nil</span> {
		log.<span style="color:#447fcf">Fatal</span>(err)
	}
	<span style="color:#6ab825;font-weight:bold">defer</span> client.<span style="color:#447fcf">Close</span>()

	modelResp, err := client.<span style="color:#447fcf">ListModels</span>(context.<span style="color:#447fcf">Background</span>())
	<span style="color:#6ab825;font-weight:bold">if</span> err != <span style="color:#6ab825;font-weight:bold">nil</span> {
		log.<span style="color:#447fcf">Fatal</span>(err)
	}

	<span style="color:#999;font-style:italic">// Use the first available model
</span><span style="color:#999;font-style:italic"></span>	model := modelResp.Models[<span style="color:#3677a9">0</span>]

	cfg := &amp;cubicpb.RecognitionConfig{
		ModelId: model.Id,
	}

	<span style="color:#999;font-style:italic">// Define a callback function to handle results
</span><span style="color:#999;font-style:italic"></span>	resultHandler := <span style="color:#6ab825;font-weight:bold">func</span>(resp *cubicpb.RecognitionResponse) {
		<span style="color:#6ab825;font-weight:bold">for</span> _, r := <span style="color:#6ab825;font-weight:bold">range</span> resp.Results {
			<span style="color:#6ab825;font-weight:bold">if</span> r.IsPartial {
				fmt.<span style="color:#447fcf">Print</span>(<span style="color:#ed9d13">&#34;\r&#34;</span>, r.Alternatives[<span style="color:#3677a9">0</span>].Transcript) <span style="color:#999;font-style:italic">// print on same line
</span><span style="color:#999;font-style:italic"></span>			} <span style="color:#6ab825;font-weight:bold">else</span> {
				fmt.<span style="color:#447fcf">Println</span>(<span style="color:#ed9d13">&#34;\r&#34;</span>, r.Alternatives[<span style="color:#3677a9">0</span>].Transcript) <span style="color:#999;font-style:italic">// print and move to new line
</span><span style="color:#999;font-style:italic"></span>			}
		}
	}

	<span style="color:#999;font-style:italic">// Create microphone stream
</span><span style="color:#999;font-style:italic"></span>	mic, err := <span style="color:#447fcf">NewMicrophone</span>(model.Attributes.SampleRate, bufferSize)
	<span style="color:#6ab825;font-weight:bold">if</span> err != <span style="color:#6ab825;font-weight:bold">nil</span> {
		log.<span style="color:#447fcf">Fatal</span>(err)
	}
	<span style="color:#6ab825;font-weight:bold">defer</span> mic.<span style="color:#447fcf">Close</span>()

	<span style="color:#999;font-style:italic">// Since Microphone implements the io.ReadCloser interface, we can
</span><span style="color:#999;font-style:italic"></span>	<span style="color:#999;font-style:italic">// pass it directly to the StreamingRecognize function.
</span><span style="color:#999;font-style:italic"></span>	err = client.<span style="color:#447fcf">StreamingRecognize</span>(context.<span style="color:#447fcf">Background</span>(), cfg, mic, resultHandler)
	<span style="color:#6ab825;font-weight:bold">if</span> err != <span style="color:#6ab825;font-weight:bold">nil</span> {
		log.<span style="color:#447fcf">Fatal</span>(err)
	}
}
</code></pre></div>
</div>


<div class="tab-pane" title="Python">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">
<span style="color:#999;font-style:italic">#</span>
<span style="color:#999;font-style:italic"># This example requires the pyaudio (http://people.csail.mit.edu/hubert/pyaudio/)</span>
<span style="color:#999;font-style:italic"># module to stream audio from a microphone. Instructions for installing pyaudio for</span>
<span style="color:#999;font-style:italic"># different systems are available at the link. On most platforms, this is simply `pip install pyaudio`.</span>

<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">cubic</span>
<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">pyaudio</span>

<span style="color:#999;font-style:italic"># set insecure to False if server uses TLS</span>
serverAddress = <span style="color:#ed9d13">&#39;127.0.0.1:2727&#39;</span>
client = cubic.Client(serverAddress, insecure=True)

<span style="color:#999;font-style:italic"># get list of available models</span>
modelResp = client.ListModels()

<span style="color:#999;font-style:italic"># use the first available model</span>
model = modelResp.models[<span style="color:#3677a9">0</span>]

cfg = cubic.RecognitionConfig(
	model_id = model.id
)

<span style="color:#999;font-style:italic"># client.StreamingRecognize takes any binary stream object that has a read(nBytes)</span>
<span style="color:#999;font-style:italic"># method. The method should return nBytes from the stream. So pyaudio is a suitable</span>
<span style="color:#999;font-style:italic"># library to use here for streaming audio from the microphone. Other libraries or</span>
<span style="color:#999;font-style:italic"># modules may also be used as long as they have the read method or have been wrapped</span>
<span style="color:#999;font-style:italic"># to do so.</span>

<span style="color:#999;font-style:italic"># open microphone stream</span>
p = pyaudio.PyAudio()
audio = p.open(format=pyaudio.paInt16,              <span style="color:#999;font-style:italic"># 16 bit samples</span>
				channels=<span style="color:#3677a9">1</span>,                         <span style="color:#999;font-style:italic"># mono audio</span>
				rate=model.attributes.sample_rate,  <span style="color:#999;font-style:italic"># sample rate in hertz</span>
				<span style="color:#24909d">input</span>=True)                         <span style="color:#999;font-style:italic"># audio input stream</span>

<span style="color:#999;font-style:italic"># send streaming request to cubic and print out results as they come in</span>
<span style="color:#6ab825;font-weight:bold">try</span>:
	<span style="color:#6ab825;font-weight:bold">for</span> resp <span style="color:#6ab825;font-weight:bold">in</span> client.StreamingRecognize(cfg, audio):
		<span style="color:#6ab825;font-weight:bold">for</span> result <span style="color:#6ab825;font-weight:bold">in</span> resp.results:
			<span style="color:#6ab825;font-weight:bold">if</span> result.is_partial:
				<span style="color:#6ab825;font-weight:bold">print</span>(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">\r</span><span style="color:#ed9d13">{0}&#34;</span>.format(result.alternatives[<span style="color:#3677a9">0</span>].transcript), end=<span style="color:#ed9d13">&#34;&#34;</span>)
			<span style="color:#6ab825;font-weight:bold">else</span>:
				<span style="color:#6ab825;font-weight:bold">print</span>(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">\r</span><span style="color:#ed9d13">{0}&#34;</span>.format(result.alternatives[<span style="color:#3677a9">0</span>].transcript), end=<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">\n</span><span style="color:#ed9d13">&#34;</span>)
<span style="color:#6ab825;font-weight:bold">except</span> <span style="color:#bbb">KeyboardInterrupt</span>:
	<span style="color:#999;font-style:italic"># stop streaming when ctrl+C pressed</span>
	<span style="color:#6ab825;font-weight:bold">pass</span>
<span style="color:#6ab825;font-weight:bold">except</span> <span style="color:#bbb">Exception</span> <span style="color:#6ab825;font-weight:bold">as</span> err:
	<span style="color:#6ab825;font-weight:bold">print</span>(<span style="color:#ed9d13">&#34;Error while trying to stream audio : {}&#34;</span>.format(err))

audio.stop_stream()
audio.close()
</code></pre></div>
</div>


<div class="tab-pane" title="C#">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c#" data-lang="c#">

<span style="color:#999;font-style:italic">// We do not currently have example C# code for streaming from a microphone.
</span><span style="color:#999;font-style:italic">// Simply pass the bytes from the microphone the same as is done from the file in
</span><span style="color:#999;font-style:italic">// the `Streaming from an audio file` example above. You can do this by implementing
</span><span style="color:#999;font-style:italic">// your own class derived from `System.IO.Stream` class which the `StreamingRecognize`
</span><span style="color:#999;font-style:italic">// method accepts.
</span><span style="color:#999;font-style:italic">//
</span><span style="color:#999;font-style:italic">// For more on the `System.IO.Stream` class see:
</span><span style="color:#999;font-style:italic">// https://docs.microsoft.com/en-us/dotnet/api/system.io.stream?view=netframework-4.8
</span><span style="color:#999;font-style:italic"></span>
</code></pre></div>
</div>


<div class="tab-pane" title="C&#43;&#43;">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++">

<span style="color:#999;font-style:italic">// For a complete C++ example, see the examples-cpp github repository:
</span><span style="color:#999;font-style:italic">// https://github.com/cobaltspeech/examples-cpp
</span><span style="color:#999;font-style:italic"></span>
</code></pre></div>
</div>


<div class="tab-pane" title="Java/Android">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">

<span style="color:#999;font-style:italic">/*
</span><span style="color:#999;font-style:italic">This example uses the `android.media.AudioRecord` class and assumes the min API level is higher than Marshmallow.
</span><span style="color:#999;font-style:italic">Please note: this example does not attempt to handle threading and all exceptions.
</span><span style="color:#999;font-style:italic">It gives a simplified overview of the essential gRPC calls.
</span><span style="color:#999;font-style:italic">
</span><span style="color:#999;font-style:italic">For a complete android example, see the examples-android github repository:
</span><span style="color:#999;font-style:italic">https://github.com/cobaltspeech/examples-android
</span><span style="color:#999;font-style:italic">*/</span>

<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">io.grpc.ManagedChannel</span>;
<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">io.grpc.ManagedChannelBuilder</span>;
<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">io.grpc.stub.StreamObserver</span>;

<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">com.google.protobuf.ByteString</span>;

<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">com.cobaltspeech.cubic.CubicGrpc</span>;
<span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">com.cobaltspeech.cubic.CubicOuterClass.*</span>;

<span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">static</span> <span style="color:#6ab825;font-weight:bold">void</span> <span style="color:#447fcf">streamMicrophoneAudio</span>() {
    <span style="color:#999;font-style:italic">// Setup connection
</span><span style="color:#999;font-style:italic"></span>    CubicGrpc.<span style="color:#bbb">CubicStub</span> mCubicService = CubicGrpc.<span style="color:#bbb">newStub</span>(
        ManagedChannelBuilder.<span style="color:#bbb">forTarget</span>(url).<span style="color:#bbb">build</span>());

    <span style="color:#999;font-style:italic">// Setup callback to handle results
</span><span style="color:#999;font-style:italic"></span>    StreamObserver&lt;&gt; responseObserver = <span style="color:#6ab825;font-weight:bold">new</span> StreamObserver&lt;RecognitionResponse&gt;() {
        <span style="color:#ffa500">@Override</span>
        <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">void</span> <span style="color:#447fcf">onNext</span>(RecognitionResponse value) {
            System.<span style="color:#bbb">out</span>.<span style="color:#bbb">println</span>(<span style="color:#ed9d13">&#34;Result: &#34;</span> + value.<span style="color:#bbb">toString</span>());
        }

        <span style="color:#ffa500">@Override</span>
        <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">void</span> <span style="color:#447fcf">onError</span>(Throwable t) {
            System.<span style="color:#bbb">err</span>.<span style="color:#bbb">println</span>(<span style="color:#ed9d13">&#34;Error with recognition:&#34;</span> + t.<span style="color:#bbb">toString</span>());
        }

        <span style="color:#ffa500">@Override</span>
        <span style="color:#6ab825;font-weight:bold">public</span> <span style="color:#6ab825;font-weight:bold">void</span> <span style="color:#447fcf">onCompleted</span>() {
            System.<span style="color:#bbb">out</span>.<span style="color:#bbb">println</span>(<span style="color:#ed9d13">&#34;Server is done sending responses back&#34;</span>);
        }
    };

    <span style="color:#999;font-style:italic">// Setup bidirectional stream
</span><span style="color:#999;font-style:italic"></span>    StreamObserver&lt;StreamingRecognizeRequest&gt; requestObserver; <span style="color:#999;font-style:italic">// Outgoing messages are sent on this request object
</span><span style="color:#999;font-style:italic"></span>    requestObserver = mCubicService.<span style="color:#bbb">streamingRecognize</span>(mRecognitionResponseObserver);

    <span style="color:#999;font-style:italic">// Send config message
</span><span style="color:#999;font-style:italic"></span>    RecognitionConfig cfg = RecognitionConfig.<span style="color:#bbb">newBuilder</span>()
            .<span style="color:#bbb">setModelId</span>(<span style="color:#ed9d13">&#34;ModelID&#34;</span>)
            .<span style="color:#bbb">build</span>();
    StreamingRecognizeRequest configs = StreamingRecognizeRequest.<span style="color:#bbb">newBuilder</span>()
        <span style="color:#999;font-style:italic">// Note, we do not call setAudio here.
</span><span style="color:#999;font-style:italic"></span>        .<span style="color:#bbb">setConfig</span>(cfg)
        .<span style="color:#bbb">build</span>();
    requestObserver.<span style="color:#bbb">onNext</span>(configs);

    <span style="color:#999;font-style:italic">// Setup the Android Micorphone Recorder
</span><span style="color:#999;font-style:italic"></span>    <span style="color:#6ab825;font-weight:bold">int</span> SAMPLE_RATE = 8000; <span style="color:#999;font-style:italic">// Same as the model is expecting
</span><span style="color:#999;font-style:italic"></span>    <span style="color:#6ab825;font-weight:bold">int</span> BUFFER_SIZE = 1024;
    AudioRecord recorder = <span style="color:#6ab825;font-weight:bold">new</span> AudioRecord(
        MediaRecorder.<span style="color:#bbb">AudioSource</span>.<span style="color:#bbb">MIC</span>,
        SAMPLE_RATE,
        AudioFormat.<span style="color:#bbb">CHANNEL_IN_MONO</span>,
        AudioFormat.<span style="color:#bbb">ENCODING_PCM_16BIT</span>,
        BUFFER_SIZE);
    <span style="color:#6ab825;font-weight:bold">byte</span>[] audioBuffer = <span style="color:#6ab825;font-weight:bold">new</span> <span style="color:#6ab825;font-weight:bold">byte</span>[BUFFER_SIZE];
    recorder.<span style="color:#bbb">startRecording</span>();

    <span style="color:#999;font-style:italic">// Read the file in chunks and stream to server.
</span><span style="color:#999;font-style:italic"></span>    <span style="color:#6ab825;font-weight:bold">while</span> (running) {
        recorder.<span style="color:#bbb">read</span>(audioBuffer, 0, BUFFER_SIZE, AudioRecord.<span style="color:#bbb">READ_BLOCKING</span>);

        <span style="color:#999;font-style:italic">// Convert byte[] to ByteString for gRPC
</span><span style="color:#999;font-style:italic"></span>        ByteString audioBS = ByteString.<span style="color:#bbb">copyFrom</span>(audioBuffer);

        <span style="color:#999;font-style:italic">// Send audio to server
</span><span style="color:#999;font-style:italic"></span>        RecognitionAudio audioMsg = RecognitionAudio.<span style="color:#bbb">newBuilder</span>()
            .<span style="color:#bbb">setData</span>(audioBS)
            .<span style="color:#bbb">build</span>();
        requestObserver.<span style="color:#bbb">onNext</span>(StreamingRecognizeRequest.<span style="color:#bbb">newBuilder</span>()
            .<span style="color:#bbb">setAudio</span>(audioMsg)
            .<span style="color:#bbb">build</span>());
    }

    <span style="color:#999;font-style:italic">// Stop the microphone recoding.
</span><span style="color:#999;font-style:italic"></span>    recorder.<span style="color:#bbb">stop</span>();

    <span style="color:#999;font-style:italic">// Close the client side stream
</span><span style="color:#999;font-style:italic"></span>    requestObserver.<span style="color:#bbb">onCompleted</span>();

    <span style="color:#999;font-style:italic">// Note: Once the server is done transcribing everything, it will call responseObserver.onCompleted().
</span><span style="color:#999;font-style:italic"></span>}
</code></pre></div>
</div>


<div class="tab-pane" title="Swift/iOS">
  <div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-swift" data-lang="swift">

<span style="color:#999;font-style:italic">// For a complete iOS example, see the `AudioRecorder class` in the examples-ios github repository:</span>
<span style="color:#999;font-style:italic">// https://github.com/cobaltspeech/examples-ios/blob/master/CubicExample/AudioRecorder.swift</span>

</code></pre></div>
</div>


</div></div>

    
    
          <footer class=" footline" >
	
</footer>
  </div>
</div>

<div id="navigation">
<a class="nav nav-prev" href="../../using-cubic-sdk/recognize/" title="Synchronous Recognition"> <i class="fa fa-chevron-left"></i><label>Synchronous Recognition</label></a>
    <a class="nav nav-next" href="../../using-cubic-sdk/recognition-context/" title="Recognition Context" style="margin-right: 0px;"><label>Recognition Context</label><i class="fa fa-chevron-right"></i></a></div>

</section>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
  <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
</div>    

<script src="../../js/clipboard.min.js"></script>
<script src="../../js/featherlight.min.js"></script>
<script src="../../js/html5shiv-printshiv.min.js"></script>

<script src="../../js/modernizr.custom.71422.js"></script>
<script src="../../js/docdock.js"></script>
<script src="../../theme-original/script.js"></script>


    

    
    

    
  </body>
</html>