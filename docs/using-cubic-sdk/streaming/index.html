<!DOCTYPE html>
<html>
  <head>
    <title>Cubic SDK -- Cobalt</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Streaming Recognition :: Cubic SDK -- Cobalt</title>
<link rel="shortcut icon" href="/sdk-cubic/images/favicon.ico" type="image/x-icon" />
<link href="/sdk-cubic/css/nucleus.css" rel="stylesheet">
<link href="/sdk-cubic/css/font-awesome.min.css" rel="stylesheet">
<link href="/sdk-cubic/css/hybrid.css" rel="stylesheet">
<link href="/sdk-cubic/css/featherlight.min.css" rel="stylesheet">
<link href="/sdk-cubic/css/auto-complete.css" rel="stylesheet">
<link href="/sdk-cubic/theme-original/style.css" rel="stylesheet">

  <link href="/sdk-cubic/theme-original/variant-blue.css" rel="stylesheet">

<link rel="stylesheet" href="/sdk-cubic/css/bootstrap.min.css">
<script src="/sdk-cubic/js/jquery-2.x.min.js"></script>
<style type="text/css">
  :root #header + #content > #left > #rlblock_left {
    display:none !important;
  }
</style>
<link href="/sdk-cubic/css/tabs.css" rel="stylesheet" type="text/css">
<script src="/sdk-cubic/js/tabs.js"></script>


    
  </head>
  <body data-url="/sdk-cubic/using-cubic-sdk/streaming/">
    
      <div id="headermain"></div>
<nav id="sidebar" class="showVisitedLinks">



<div class="highlightable">
  <div id="header-wrapper">
    <div id="header">
      
	
  
    <p><img src="/sdk-cubic/images/logo-white.png" alt="Cobalt&rsquo;s SDK Documentation"></p>
<p>Cubic SDK &ndash; Cobalt</p>

  


    </div>
        <div class="searchbox">
		    <label for="search-by"><i class="fa fa-search"></i></label>
		    <input data-search-input id="search-by" type="text" placeholder="Search...">
		    <span data-search-clear=""><i class="fa fa-close"></i></span>
		</div>
		<script type="text/javascript" src="/sdk-cubic/js/lunr.min.js"></script>
		<script type="text/javascript" src="/sdk-cubic/js/auto-complete.js"></script>
		<script type="text/javascript">
        
            var baseurl = "https:\/\/cobaltspeech.github.io\/sdk-cubic";
        
		</script>
		<script type="text/javascript" src="/sdk-cubic/js/search.js"></script>
  </div>

      <ul class="topics">
            <li data-nav-id="/sdk-cubic/" class="dd-item">
            <a href="/sdk-cubic/"><i class="fa fa-fw fa-home"></i></a>
            </li>
    <li data-nav-id="/sdk-cubic/getting-started/" class="dd-item
        ">
      <div>
      <a href="/sdk-cubic/getting-started/">Server Setup</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/sdk-cubic/using-cubic-sdk/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/sdk-cubic/using-cubic-sdk/">Using Cubic-SDK</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/sdk-cubic/using-cubic-sdk/installation/" class="dd-item">
        <div>
          <a href="/sdk-cubic/using-cubic-sdk/installation/">
            Installing the SDK
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-cubic/using-cubic-sdk/connecting/" class="dd-item">
        <div>
          <a href="/sdk-cubic/using-cubic-sdk/connecting/">
            Setup Connection
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-cubic/using-cubic-sdk/recognize/" class="dd-item">
        <div>
          <a href="/sdk-cubic/using-cubic-sdk/recognize/">
            Synchronous Recognition
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-cubic/using-cubic-sdk/streaming/" class="dd-item active">
        <div>
          <a href="/sdk-cubic/using-cubic-sdk/streaming/">
            Streaming Recognition
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-cubic/using-cubic-sdk/client-configs/" class="dd-item">
        <div>
          <a href="/sdk-cubic/using-cubic-sdk/client-configs/">
            Recognition Configurations
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/sdk-cubic/using-cubic-sdk/android/" class="dd-item">
        <div>
          <a href="/sdk-cubic/using-cubic-sdk/android/">
            Android Integrations
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/sdk-cubic/protobuf/" class="dd-item haschildren
        ">
      <div>
      <a href="/sdk-cubic/protobuf/">Cubic API Reference</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/sdk-cubic/protobuf/autogen-doc-cubic-proto/" class="dd-item">
        <div>
          <a href="/sdk-cubic/protobuf/autogen-doc-cubic-proto/">
            Cubic Protobuf API Docs
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>



        <section id="shortcuts">
                <li class="" role=""><h3>More</h3><a href="https://github.com/cobaltspeech/sdk-cubic" target="_blank" rel="noopener"><i class='fa fa-github'></i> <label>Github repo</label></a></li>
                <li class="" role=""><a href="https://www.cobaltspeech.com/contact" target="_blank" rel="noopener"><i class='fa fa-bookmark'></i> <label>Contact us</label></a></li>
        </section>
            <a id="clear-history" class="" href="#" data-clear-history-toggle=""><i class="fa  fa-history"></i> Clear History</a>

    <hr />
    <li></li>
    
    </ul>

 <section id="footer">
    </section>
  </div>
</nav>



<section id="body">
<div id="overlay"></div>
<div class="padding highlightable">

  <div id="top-bar">
    <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
        <span id="sidebar-toggle-span">
          <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
            <i class="fa fa-bars"></i>
          </a>
        </span>
        <span id="toc-menu"><i class="fa fa-list-alt"></i></span>
        <span class="links">
        







 <a href='/sdk-cubic/'>Cubic SDK Documentation</a> > <a href='/sdk-cubic/using-cubic-sdk/'>Using Cubic-SDK</a> > Streaming Recognition

 

 

   
        </span>
    </div>
    
    
    <div class="progress">
        <div class="wrapper">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#streaming-from-an-audio-file">Streaming from an audio file</a></li>
        <li><a href="#streaming-from-microphone">Streaming from microphone</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
    </div>
    

  </div>


<div id="body-inner">
  
    <h1>Streaming Recognition</h1>
  



    
    
    
    <p>The following example shows how to transcribe an audio file using Cubicâ€™s
Streaming Recognize Request. The stream can come from a file on disk or be
directly from a microphone in real time.</p>
<h3 id="streaming-from-an-audio-file">Streaming from an audio file</h3>
<p>We support several file formats including WAV, MP3, FLAC etc. For more details, please
see the protocol buffer specification file in the SDK repository (<code>grpc/cubic.proto</code>).
The examples below use a WAV file as input to the streaming recognition. We will query
the server for available models and use the first model to transcribe the speech.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->import<!-- raw HTML omitted --> (
<!-- raw HTML omitted -->&quot;context&quot;<!-- raw HTML omitted -->
<!-- raw HTML omitted -->&quot;fmt&quot;<!-- raw HTML omitted -->
<!-- raw HTML omitted -->&quot;log&quot;<!-- raw HTML omitted -->
<!-- raw HTML omitted -->&quot;os&quot;<!-- raw HTML omitted --></p>
<pre><code>&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;github.com/cobaltspeech/sdk-cubic/grpc/go-cubic&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;github.com/cobaltspeech/sdk-cubic/grpc/go-cubic/cubicpb&amp;#34;&lt;/span&gt;
</code></pre>
<p>)</p>
<p><!-- raw HTML omitted -->const<!-- raw HTML omitted --> serverAddr = <!-- raw HTML omitted -->&quot;127.0.0.1:2727&quot;<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->func<!-- raw HTML omitted --> <!-- raw HTML omitted -->main<!-- raw HTML omitted -->() {
client, err := cubic.<!-- raw HTML omitted -->NewClient<!-- raw HTML omitted -->(serverAddr)
<!-- raw HTML omitted -->if<!-- raw HTML omitted --> err != <!-- raw HTML omitted -->nil<!-- raw HTML omitted --> {
log.<!-- raw HTML omitted -->Fatal<!-- raw HTML omitted -->(err)
}
<!-- raw HTML omitted -->defer<!-- raw HTML omitted --> client.<!-- raw HTML omitted -->Close<!-- raw HTML omitted -->()</p>
<pre><code>modelResp, err := client.&lt;span style=&quot;color:#447fcf&quot;&gt;ListModels&lt;/span&gt;(context.&lt;span style=&quot;color:#447fcf&quot;&gt;Background&lt;/span&gt;())
&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;if&lt;/span&gt; err != &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;nil&lt;/span&gt; {
    log.&lt;span style=&quot;color:#447fcf&quot;&gt;Fatal&lt;/span&gt;(err)
}

&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Use the first available model
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->	model := modelResp.Models[<!-- raw HTML omitted -->0<!-- raw HTML omitted -->]</p>
<pre><code>f, err := os.&lt;span style=&quot;color:#447fcf&quot;&gt;Open&lt;/span&gt;(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;test.wav&amp;#34;&lt;/span&gt;)
&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;if&lt;/span&gt; err != &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;nil&lt;/span&gt; {
    log.&lt;span style=&quot;color:#447fcf&quot;&gt;Fatal&lt;/span&gt;(err)
}

&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;defer&lt;/span&gt; f.&lt;span style=&quot;color:#447fcf&quot;&gt;Close&lt;/span&gt;()

cfg := &amp;amp;cubicpb.RecognitionConfig{
    ModelId: model.Id,
}

&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Define a callback function to handle results
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->	resultHandler := <!-- raw HTML omitted -->func<!-- raw HTML omitted -->(resp *cubicpb.RecognitionResponse) {
<!-- raw HTML omitted -->for<!-- raw HTML omitted --> _, r := <!-- raw HTML omitted -->range<!-- raw HTML omitted --> resp.Results {
<!-- raw HTML omitted -->if<!-- raw HTML omitted --> !r.IsPartial {
fmt.<!-- raw HTML omitted -->Println<!-- raw HTML omitted -->(r.Alternatives[<!-- raw HTML omitted -->0<!-- raw HTML omitted -->].Transcript)
}
}
}</p>
<pre><code>err = client.&lt;span style=&quot;color:#447fcf&quot;&gt;StreamingRecognize&lt;/span&gt;(context.&lt;span style=&quot;color:#447fcf&quot;&gt;Background&lt;/span&gt;(), cfg, f, resultHandler)
&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;if&lt;/span&gt; err != &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;nil&lt;/span&gt; {
    log.&lt;span style=&quot;color:#447fcf&quot;&gt;Fatal&lt;/span&gt;(err)
}
</code></pre>
<p>}
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>serverAddress = <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->'<!-- raw HTML omitted --><!-- raw HTML omitted -->127.0.0.1:2727<!-- raw HTML omitted --><!-- raw HTML omitted -->'<!-- raw HTML omitted --></p>
<p>client = cubic.Client(serverAddress)</p>
<p><!-- raw HTML omitted --># get list of available models<!-- raw HTML omitted -->
modelResp = client.ListModels()
<!-- raw HTML omitted -->for<!-- raw HTML omitted --> model <!-- raw HTML omitted -->in<!-- raw HTML omitted --> modelResp.models:
<!-- raw HTML omitted -->print<!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->ID = {}, Name = {}<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted -->.format(model.id, model.name))</p>
<p><!-- raw HTML omitted --># use the first available model<!-- raw HTML omitted -->
model = modelResp.models[<!-- raw HTML omitted -->0<!-- raw HTML omitted -->]</p>
<p>cfg = cubic.RecognitionConfig(
model_id = model.id
)</p>
<p><!-- raw HTML omitted --># client.StreamingRecognize takes any binary<!-- raw HTML omitted -->
<!-- raw HTML omitted --># stream object that has a read(nBytes) method.<!-- raw HTML omitted -->
<!-- raw HTML omitted --># The method should return nBytes from the stream.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --># open audio file stream<!-- raw HTML omitted -->
audio = <!-- raw HTML omitted -->open<!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->'<!-- raw HTML omitted --><!-- raw HTML omitted -->test.wav<!-- raw HTML omitted --><!-- raw HTML omitted -->'<!-- raw HTML omitted -->, <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->'<!-- raw HTML omitted --><!-- raw HTML omitted -->rb<!-- raw HTML omitted --><!-- raw HTML omitted -->'<!-- raw HTML omitted -->)</p>
<p><!-- raw HTML omitted --># send streaming request to cubic and <!-- raw HTML omitted -->
<!-- raw HTML omitted --># print out results as they come in<!-- raw HTML omitted -->
<!-- raw HTML omitted -->for<!-- raw HTML omitted --> resp <!-- raw HTML omitted -->in<!-- raw HTML omitted --> client.StreamingRecognize(cfg, audio):
<!-- raw HTML omitted -->for<!-- raw HTML omitted --> result <!-- raw HTML omitted -->in<!-- raw HTML omitted --> resp.results:
<!-- raw HTML omitted -->if<!-- raw HTML omitted --> result.is_partial:
<!-- raw HTML omitted -->print<!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->\r<!-- raw HTML omitted --><!-- raw HTML omitted -->{0}<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted -->.format(result.alternatives[<!-- raw HTML omitted -->0<!-- raw HTML omitted -->].transcript), end=<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted -->)
<!-- raw HTML omitted -->else<!-- raw HTML omitted -->:
<!-- raw HTML omitted -->print<!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->\r<!-- raw HTML omitted --><!-- raw HTML omitted -->{0}<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted -->.format(result.alternatives[<!-- raw HTML omitted -->0<!-- raw HTML omitted -->].transcript), end=<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->\n<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted -->)</p>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->// List the available models
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->var<!-- raw HTML omitted --> listModelsRequest = <!-- raw HTML omitted -->new<!-- raw HTML omitted --> CobaltSpeech.Cubic.ListModelsRequest();
<!-- raw HTML omitted -->var<!-- raw HTML omitted --> models = client.ListModels(listModelsRequest);</p>
<p><!-- raw HTML omitted -->// Setup the bi-directional gRPC stream.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->var<!-- raw HTML omitted --> call = client.StreamingRecognize();
<!-- raw HTML omitted -->using<!-- raw HTML omitted --> (call)
{
<!-- raw HTML omitted -->// Setup recieve task
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->var<!-- raw HTML omitted --> responseReaderTask = Task.Run(<!-- raw HTML omitted -->async<!-- raw HTML omitted --> () =&gt;
{
<!-- raw HTML omitted -->// Wait for the next response
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted -->while<!-- raw HTML omitted --> (<!-- raw HTML omitted -->await<!-- raw HTML omitted --> call.ResponseStream.MoveNext())
{
<!-- raw HTML omitted -->var<!-- raw HTML omitted --> response = call.ResponseStream.Current;
<!-- raw HTML omitted -->foreach<!-- raw HTML omitted --> (<!-- raw HTML omitted -->var<!-- raw HTML omitted --> result <!-- raw HTML omitted -->in<!-- raw HTML omitted --> response.Results)
{
Console.WriteLine(result.Alternatives[<!-- raw HTML omitted -->0<!-- raw HTML omitted -->].Transcript);
}
}
});</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Send config first, followed by the audio
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    {
<!-- raw HTML omitted -->// Send the configs
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted -->var<!-- raw HTML omitted --> request = <!-- raw HTML omitted -->new<!-- raw HTML omitted --> CobaltSpeech.Cubic.StreamingRecognizeRequest();
request.Config = cfg;
<!-- raw HTML omitted -->await<!-- raw HTML omitted --> call.RequestStream.WriteAsync(request);</p>
<pre><code>    &lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Setup object for streaming audio
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        request.Config = <!-- raw HTML omitted -->null<!-- raw HTML omitted -->;
request.Audio = <!-- raw HTML omitted -->new<!-- raw HTML omitted --> CobaltSpeech.Cubic.RecognitionAudio { };</p>
<pre><code>    &lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Send the audio, in 8kb chunks
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted -->const<!-- raw HTML omitted --> <!-- raw HTML omitted -->int<!-- raw HTML omitted --> chunkSize = <!-- raw HTML omitted -->8<!-- raw HTML omitted --><!-- raw HTML omitted -->1<!-- raw HTML omitted --><!-- raw HTML omitted -->9<!-- raw HTML omitted --><!-- raw HTML omitted -->2<!-- raw HTML omitted -->;
<!-- raw HTML omitted -->using<!-- raw HTML omitted --> (FileStream file = File.OpenRead(<!-- raw HTML omitted -->&quot;test.raw&quot;<!-- raw HTML omitted -->))
{
<!-- raw HTML omitted -->int<!-- raw HTML omitted --> bytesRead;
<!-- raw HTML omitted -->var<!-- raw HTML omitted --> buffer = <!-- raw HTML omitted -->new<!-- raw HTML omitted --> <!-- raw HTML omitted -->byte<!-- raw HTML omitted -->[chunkSize];
<!-- raw HTML omitted -->while<!-- raw HTML omitted --> ((bytesRead = file.Read(buffer, <!-- raw HTML omitted -->0<!-- raw HTML omitted -->, buffer.Length)) &gt; <!-- raw HTML omitted -->0<!-- raw HTML omitted -->)
{
<!-- raw HTML omitted -->var<!-- raw HTML omitted --> bytes = Google.Protobuf.ByteString.CopyFrom(buffer);
request.Audio.Data = bytes;
<!-- raw HTML omitted -->await<!-- raw HTML omitted --> call.RequestStream.WriteAsync(request);
}</p>
<pre><code>        &lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Close the sending stream
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->            <!-- raw HTML omitted -->await<!-- raw HTML omitted --> call.RequestStream.CompleteAsync();
}
}</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Wait for all of the responses to come back through the receiving stream
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->await<!-- raw HTML omitted --> responseReaderTask;
}
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->import<!-- raw HTML omitted --> <!-- raw HTML omitted -->com.google.protobuf.ByteString<!-- raw HTML omitted -->;</p>
<p><!-- raw HTML omitted -->import<!-- raw HTML omitted --> <!-- raw HTML omitted -->com.cobaltspeech.cubic.CubicGrpc<!-- raw HTML omitted -->;
<!-- raw HTML omitted -->import<!-- raw HTML omitted --> <!-- raw HTML omitted -->com.cobaltspeech.cubic.CubicOuterClass.*<!-- raw HTML omitted -->;</p>
<p><!-- raw HTML omitted -->public<!-- raw HTML omitted --> <!-- raw HTML omitted -->static<!-- raw HTML omitted --> <!-- raw HTML omitted -->void<!-- raw HTML omitted --> <!-- raw HTML omitted -->transcribeFile<!-- raw HTML omitted -->() {
<!-- raw HTML omitted -->// Setup connection
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    CubicGrpc.<!-- raw HTML omitted -->CubicStub<!-- raw HTML omitted --> mCubicService = CubicGrpc.<!-- raw HTML omitted -->newStub<!-- raw HTML omitted -->(
ManagedChannelBuilder.<!-- raw HTML omitted -->forTarget<!-- raw HTML omitted -->(url).<!-- raw HTML omitted -->build<!-- raw HTML omitted -->());</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Setup callback to handle results
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    StreamObserver&lt;&gt; responseObserver = <!-- raw HTML omitted -->new<!-- raw HTML omitted --> StreamObserver&lt;RecognitionResponse&gt;() {
<!-- raw HTML omitted -->@Override<!-- raw HTML omitted -->
<!-- raw HTML omitted -->public<!-- raw HTML omitted --> <!-- raw HTML omitted -->void<!-- raw HTML omitted --> <!-- raw HTML omitted -->onNext<!-- raw HTML omitted -->(RecognitionResponse value) {
System.<!-- raw HTML omitted -->out<!-- raw HTML omitted -->.<!-- raw HTML omitted -->println<!-- raw HTML omitted -->(<!-- raw HTML omitted -->&quot;Result: &quot;<!-- raw HTML omitted --> + value.<!-- raw HTML omitted -->toString<!-- raw HTML omitted -->());
}</p>
<pre><code>    &lt;span style=&quot;color:#ffa500&quot;&gt;@Override&lt;/span&gt;
    &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color:#447fcf&quot;&gt;onError&lt;/span&gt;(Throwable t) {
        System.&lt;span style=&quot;color:#bbb&quot;&gt;err&lt;/span&gt;.&lt;span style=&quot;color:#bbb&quot;&gt;println&lt;/span&gt;(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;Error with recognition:&amp;#34;&lt;/span&gt; + t.&lt;span style=&quot;color:#bbb&quot;&gt;toString&lt;/span&gt;());
    }

    &lt;span style=&quot;color:#ffa500&quot;&gt;@Override&lt;/span&gt;
    &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color:#447fcf&quot;&gt;onCompleted&lt;/span&gt;() {
        System.&lt;span style=&quot;color:#bbb&quot;&gt;out&lt;/span&gt;.&lt;span style=&quot;color:#bbb&quot;&gt;println&lt;/span&gt;(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;Server is done sending responses back&amp;#34;&lt;/span&gt;);
    }
};

&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Setup bidirectional stream
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    StreamObserver&lt;StreamingRecognizeRequest&gt; requestObserver; <!-- raw HTML omitted -->// Outgoing messages are sent on this request object
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    requestObserver = mCubicService.<!-- raw HTML omitted -->streamingRecognize<!-- raw HTML omitted -->(mRecognitionResponseObserver);</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Send config message
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    StreamingRecognizeRequest configs = StreamingRecognizeRequest.<!-- raw HTML omitted -->newBuilder<!-- raw HTML omitted -->()
<!-- raw HTML omitted -->// Note, we do not call setAudio here.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        .<!-- raw HTML omitted -->setConfig<!-- raw HTML omitted -->(RecognitionConfig.<!-- raw HTML omitted -->newBuilder<!-- raw HTML omitted -->()
.<!-- raw HTML omitted -->setModelId<!-- raw HTML omitted -->(<!-- raw HTML omitted -->&quot;ModelID&quot;<!-- raw HTML omitted -->)
.<!-- raw HTML omitted -->build<!-- raw HTML omitted -->())
.<!-- raw HTML omitted -->build<!-- raw HTML omitted -->();
requestObserver.<!-- raw HTML omitted -->onNext<!-- raw HTML omitted -->(configs);</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Read the file in chunks and stream to server.
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->try<!-- raw HTML omitted --> {
FileInputStream is = <!-- raw HTML omitted -->new<!-- raw HTML omitted --> FileInputStream(<!-- raw HTML omitted -->new<!-- raw HTML omitted --> File(<!-- raw HTML omitted -->&quot;/path/to/file&quot;<!-- raw HTML omitted -->));
<!-- raw HTML omitted -->byte<!-- raw HTML omitted -->[] bytes = <!-- raw HTML omitted -->new<!-- raw HTML omitted --> <!-- raw HTML omitted -->byte<!-- raw HTML omitted -->[1024];
<!-- raw HTML omitted -->int<!-- raw HTML omitted --> len = 0;</p>
<pre><code>    &lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Read the file
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        <!-- raw HTML omitted -->while<!-- raw HTML omitted --> ((len = is.<!-- raw HTML omitted -->read<!-- raw HTML omitted -->(chunk)) != -1) {
<!-- raw HTML omitted -->// Convert byte[] to ByteString for gRPC
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->            ByteString audioBS = ByteString.<!-- raw HTML omitted -->copyFrom<!-- raw HTML omitted -->(chunk);</p>
<pre><code>        &lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Send audio to server
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->            RecognitionAudio audioMsg = RecognitionAudio.<!-- raw HTML omitted -->newBuilder<!-- raw HTML omitted -->()
.<!-- raw HTML omitted -->setData<!-- raw HTML omitted -->(audioBS)
.<!-- raw HTML omitted -->build<!-- raw HTML omitted -->()
requestObserver.<!-- raw HTML omitted -->onNext<!-- raw HTML omitted -->(StreamingRecognizeRequest.<!-- raw HTML omitted -->newBuilder<!-- raw HTML omitted -->()
.<!-- raw HTML omitted -->setAudio<!-- raw HTML omitted -->(audioMsg)
.<!-- raw HTML omitted -->build<!-- raw HTML omitted -->());
}
} <!-- raw HTML omitted -->catch<!-- raw HTML omitted --> (Exception e) { } <!-- raw HTML omitted -->// Handle exception
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->
<!-- raw HTML omitted -->// Close the client side stream
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    requestObserver.<!-- raw HTML omitted -->onCompleted<!-- raw HTML omitted -->();</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Note: Once the server is done transcribing everything, responseObserver.onCompleted() will be called.
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->}
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h3 id="streaming-from-microphone">Streaming from microphone</h3>
<p>Streaming audio from microphone input typically needs us to interact with system
libraries. There are several options available, and although the examples here use
one, you may choose to use an alternative as long as the recording audio format is
chosen correctly.</p>
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->import<!-- raw HTML omitted --> (
<!-- raw HTML omitted -->&quot;bytes&quot;<!-- raw HTML omitted -->
<!-- raw HTML omitted -->&quot;context&quot;<!-- raw HTML omitted -->
<!-- raw HTML omitted -->&quot;encoding/binary&quot;<!-- raw HTML omitted -->
<!-- raw HTML omitted -->&quot;fmt&quot;<!-- raw HTML omitted -->
<!-- raw HTML omitted -->&quot;log&quot;<!-- raw HTML omitted --></p>
<pre><code>&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;github.com/cobaltspeech/sdk-cubic/grpc/go-cubic&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;github.com/cobaltspeech/sdk-cubic/grpc/go-cubic/cubicpb&amp;#34;&lt;/span&gt;
&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;github.com/gordonklaus/portaudio&amp;#34;&lt;/span&gt;
</code></pre>
<p>)</p>
<p><!-- raw HTML omitted -->const<!-- raw HTML omitted --> serverAddr = <!-- raw HTML omitted -->&quot;127.0.0.1:2727&quot;<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->// Microphone implements the io.ReadCloser interface and provides
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->// a data stream for microphone input.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->type<!-- raw HTML omitted --> Microphone <!-- raw HTML omitted -->struct<!-- raw HTML omitted --> {
buffer []<!-- raw HTML omitted -->int16<!-- raw HTML omitted -->
stream *portaudio.Stream
}</p>
<p><!-- raw HTML omitted -->// NewMicrophone instantiates a Microphone object with the desired
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->// sampling rate and buffer size. When streaming to cubic, the sample
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->// rate should be set to the sample rate of the model used.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->func<!-- raw HTML omitted --> <!-- raw HTML omitted -->NewMicrophone<!-- raw HTML omitted -->(sampleRate, bufferSize <!-- raw HTML omitted -->uint32<!-- raw HTML omitted -->) (*Microphone, <!-- raw HTML omitted -->error<!-- raw HTML omitted -->) {</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// bufferSize is measured in number of bytes. Since we are capturing
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->	<!-- raw HTML omitted -->// 16 bit audio, each sample is 2 bytes. The microphone has a int16
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->	<!-- raw HTML omitted -->// buffer, so we use the number of samples as its size.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->	numSamples := bufferSize/<!-- raw HTML omitted -->2<!-- raw HTML omitted -->
mic := Microphone{buffer: <!-- raw HTML omitted -->make<!-- raw HTML omitted -->([]<!-- raw HTML omitted -->int16<!-- raw HTML omitted -->, numSamples)}</p>
<pre><code>portaudio.&lt;span style=&quot;color:#447fcf&quot;&gt;Initialize&lt;/span&gt;()
stream, err := portaudio.&lt;span style=&quot;color:#447fcf&quot;&gt;OpenDefaultStream&lt;/span&gt;(&lt;span style=&quot;color:#3677a9&quot;&gt;1&lt;/span&gt;, &lt;span style=&quot;color:#3677a9&quot;&gt;0&lt;/span&gt;, &lt;span style=&quot;color:#24909d&quot;&gt;float64&lt;/span&gt;(sampleRate), &lt;span style=&quot;color:#24909d&quot;&gt;int&lt;/span&gt;(numSamples), mic.buffer)
&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;if&lt;/span&gt; err != &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;nil&lt;/span&gt; {
    &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;nil&lt;/span&gt;, err
}
mic.stream = stream

err = mic.stream.&lt;span style=&quot;color:#447fcf&quot;&gt;Start&lt;/span&gt;()
&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;if&lt;/span&gt; err != &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;nil&lt;/span&gt; {
    &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;return&lt;/span&gt; &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;nil&lt;/span&gt;, err
}

&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;return&lt;/span&gt; &amp;amp;mic, &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;nil&lt;/span&gt;
</code></pre>
<p>}</p>
<p><!-- raw HTML omitted -->// Read copies N bytes into the passed buffer from the microphone audio buffer
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->// where N is the buffer size passed to <code>cubic.NewClient</code>. Also, to be compatible
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->// with the cubic client, it returns two things : an int representing the number of
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->// bytes copied and an error.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->func<!-- raw HTML omitted --> (mic *Microphone) <!-- raw HTML omitted -->Read<!-- raw HTML omitted -->(buffer []<!-- raw HTML omitted -->byte<!-- raw HTML omitted -->) (<!-- raw HTML omitted -->int<!-- raw HTML omitted -->, <!-- raw HTML omitted -->error<!-- raw HTML omitted -->) {
err := mic.stream.<!-- raw HTML omitted -->Read<!-- raw HTML omitted -->()
<!-- raw HTML omitted -->if<!-- raw HTML omitted --> err != <!-- raw HTML omitted -->nil<!-- raw HTML omitted --> {
<!-- raw HTML omitted -->return<!-- raw HTML omitted --> <!-- raw HTML omitted -->0<!-- raw HTML omitted -->, err
}
byteBuffer := <!-- raw HTML omitted -->new<!-- raw HTML omitted -->(bytes.Buffer)
err = binary.<!-- raw HTML omitted -->Write<!-- raw HTML omitted -->(byteBuffer, binary.LittleEndian, mic.buffer)
<!-- raw HTML omitted -->if<!-- raw HTML omitted --> err != <!-- raw HTML omitted -->nil<!-- raw HTML omitted --> {
<!-- raw HTML omitted -->return<!-- raw HTML omitted --> <!-- raw HTML omitted -->0<!-- raw HTML omitted -->, err
}
<!-- raw HTML omitted -->copy<!-- raw HTML omitted -->(buffer, byteBuffer.<!-- raw HTML omitted -->Bytes<!-- raw HTML omitted -->())
<!-- raw HTML omitted -->return<!-- raw HTML omitted --> <!-- raw HTML omitted -->len<!-- raw HTML omitted -->(buffer), <!-- raw HTML omitted -->nil<!-- raw HTML omitted -->
}</p>
<p><!-- raw HTML omitted -->// Close shuts the microphone stream down and cleans up
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->func<!-- raw HTML omitted --> (mic *Microphone) <!-- raw HTML omitted -->Close<!-- raw HTML omitted -->() {
mic.stream.<!-- raw HTML omitted -->Stop<!-- raw HTML omitted -->()
mic.stream.<!-- raw HTML omitted -->Close<!-- raw HTML omitted -->()
portaudio.<!-- raw HTML omitted -->Terminate<!-- raw HTML omitted -->()
}</p>
<p><!-- raw HTML omitted -->func<!-- raw HTML omitted --> <!-- raw HTML omitted -->main<!-- raw HTML omitted -->() {</p>
<pre><code>bufferSize := &lt;span style=&quot;color:#24909d&quot;&gt;uint32&lt;/span&gt;(&lt;span style=&quot;color:#3677a9&quot;&gt;8192&lt;/span&gt;)
client, err := cubic.&lt;span style=&quot;color:#447fcf&quot;&gt;NewClient&lt;/span&gt;(serverAddr, cubic.&lt;span style=&quot;color:#447fcf&quot;&gt;WithInsecure&lt;/span&gt;(), cubic.&lt;span style=&quot;color:#447fcf&quot;&gt;WithStreamingBufferSize&lt;/span&gt;(bufferSize))
&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;if&lt;/span&gt; err != &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;nil&lt;/span&gt; {
    log.&lt;span style=&quot;color:#447fcf&quot;&gt;Fatal&lt;/span&gt;(err)
}
&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;defer&lt;/span&gt; client.&lt;span style=&quot;color:#447fcf&quot;&gt;Close&lt;/span&gt;()

modelResp, err := client.&lt;span style=&quot;color:#447fcf&quot;&gt;ListModels&lt;/span&gt;(context.&lt;span style=&quot;color:#447fcf&quot;&gt;Background&lt;/span&gt;())
&lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;if&lt;/span&gt; err != &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;nil&lt;/span&gt; {
    log.&lt;span style=&quot;color:#447fcf&quot;&gt;Fatal&lt;/span&gt;(err)
}

&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Use the first available model
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->	model := modelResp.Models[<!-- raw HTML omitted -->0<!-- raw HTML omitted -->]</p>
<pre><code>cfg := &amp;amp;cubicpb.RecognitionConfig{
    ModelId: model.Id,
}

&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Define a callback function to handle results
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->	resultHandler := <!-- raw HTML omitted -->func<!-- raw HTML omitted -->(resp *cubicpb.RecognitionResponse) {
<!-- raw HTML omitted -->for<!-- raw HTML omitted --> _, r := <!-- raw HTML omitted -->range<!-- raw HTML omitted --> resp.Results {
<!-- raw HTML omitted -->if<!-- raw HTML omitted --> r.IsPartial {
fmt.<!-- raw HTML omitted -->Print<!-- raw HTML omitted -->(<!-- raw HTML omitted -->&quot;\r&quot;<!-- raw HTML omitted -->, r.Alternatives[<!-- raw HTML omitted -->0<!-- raw HTML omitted -->].Transcript) <!-- raw HTML omitted -->// print on same line
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->			} <!-- raw HTML omitted -->else<!-- raw HTML omitted --> {
fmt.<!-- raw HTML omitted -->Println<!-- raw HTML omitted -->(<!-- raw HTML omitted -->&quot;\r&quot;<!-- raw HTML omitted -->, r.Alternatives[<!-- raw HTML omitted -->0<!-- raw HTML omitted -->].Transcript) <!-- raw HTML omitted -->// print and move to new line
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->			}
}
}</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Create microphone stream
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->	mic, err := <!-- raw HTML omitted -->NewMicrophone<!-- raw HTML omitted -->(model.Attributes.SampleRate, bufferSize)
<!-- raw HTML omitted -->if<!-- raw HTML omitted --> err != <!-- raw HTML omitted -->nil<!-- raw HTML omitted --> {
log.<!-- raw HTML omitted -->Fatal<!-- raw HTML omitted -->(err)
}
<!-- raw HTML omitted -->defer<!-- raw HTML omitted --> mic.<!-- raw HTML omitted -->Close<!-- raw HTML omitted -->()</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Since Microphone implements the io.ReadCloser interface, we can
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->	<!-- raw HTML omitted -->// pass it directly to the StreamingRecognize function.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->	err = client.<!-- raw HTML omitted -->StreamingRecognize<!-- raw HTML omitted -->(context.<!-- raw HTML omitted -->Background<!-- raw HTML omitted -->(), cfg, mic, resultHandler)
<!-- raw HTML omitted -->if<!-- raw HTML omitted --> err != <!-- raw HTML omitted -->nil<!-- raw HTML omitted --> {
log.<!-- raw HTML omitted -->Fatal<!-- raw HTML omitted -->(err)
}
}
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>serverAddress = <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->'<!-- raw HTML omitted --><!-- raw HTML omitted -->127.0.0.1:2727<!-- raw HTML omitted --><!-- raw HTML omitted -->'<!-- raw HTML omitted --></p>
<p>client = cubic.Client(serverAddress)</p>
<p><!-- raw HTML omitted --># get list of available models<!-- raw HTML omitted -->
modelResp = client.ListModels()</p>
<p><!-- raw HTML omitted --># use the first available model<!-- raw HTML omitted -->
model = modelResp.models[<!-- raw HTML omitted -->0<!-- raw HTML omitted -->]</p>
<p>cfg = cubic.RecognitionConfig(
model_id = model.id
)</p>
<p><!-- raw HTML omitted --># client.StreamingRecognize takes any binary stream object that has a read(nBytes)<!-- raw HTML omitted -->
<!-- raw HTML omitted --># method. The method should return nBytes from the stream. So pyaudio is a suitable<!-- raw HTML omitted -->
<!-- raw HTML omitted --># library to use here for streaming audio from the microphone. Other libraries or<!-- raw HTML omitted -->
<!-- raw HTML omitted --># modules may also be used as long as they have the read method or have been wrapped<!-- raw HTML omitted -->
<!-- raw HTML omitted --># to do so.<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --># open microphone stream<!-- raw HTML omitted -->
p = pyaudio.PyAudio()
audio = p.open(format=pyaudio.paInt16,              <!-- raw HTML omitted --># 16 bit samples<!-- raw HTML omitted -->
channels=<!-- raw HTML omitted -->1<!-- raw HTML omitted -->,                         <!-- raw HTML omitted --># mono audio<!-- raw HTML omitted -->
rate=model.attributes.sample_rate,  <!-- raw HTML omitted --># sample rate in hertz<!-- raw HTML omitted -->
<!-- raw HTML omitted -->input<!-- raw HTML omitted -->=True)                         <!-- raw HTML omitted --># audio input stream<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted --># send streaming request to cubic and <!-- raw HTML omitted -->
<!-- raw HTML omitted --># print out results as they come in<!-- raw HTML omitted -->
<!-- raw HTML omitted -->try<!-- raw HTML omitted -->:
<!-- raw HTML omitted -->for<!-- raw HTML omitted --> resp <!-- raw HTML omitted -->in<!-- raw HTML omitted --> client.StreamingRecognize(cfg, audio):
<!-- raw HTML omitted -->for<!-- raw HTML omitted --> result <!-- raw HTML omitted -->in<!-- raw HTML omitted --> resp.results:
<!-- raw HTML omitted -->if<!-- raw HTML omitted --> result.is_partial:
<!-- raw HTML omitted -->print<!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->\r<!-- raw HTML omitted --><!-- raw HTML omitted -->{0}<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted -->.format(result.alternatives[<!-- raw HTML omitted -->0<!-- raw HTML omitted -->].transcript), end=<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted -->)
<!-- raw HTML omitted -->else<!-- raw HTML omitted -->:
<!-- raw HTML omitted -->print<!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->\r<!-- raw HTML omitted --><!-- raw HTML omitted -->{0}<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted -->.format(result.alternatives[<!-- raw HTML omitted -->0<!-- raw HTML omitted -->].transcript), end=<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->\n<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted -->)
<!-- raw HTML omitted -->except<!-- raw HTML omitted --> <!-- raw HTML omitted -->KeyboardInterrupt<!-- raw HTML omitted -->:
<!-- raw HTML omitted --># stop streaming when ctrl+C pressed<!-- raw HTML omitted -->
<!-- raw HTML omitted -->pass<!-- raw HTML omitted -->
<!-- raw HTML omitted -->except<!-- raw HTML omitted --> <!-- raw HTML omitted -->Exception<!-- raw HTML omitted --> <!-- raw HTML omitted -->as<!-- raw HTML omitted --> err:
<!-- raw HTML omitted -->print<!-- raw HTML omitted -->(<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted --><!-- raw HTML omitted -->Error while trying to stream audio : {}<!-- raw HTML omitted --><!-- raw HTML omitted -->&quot;<!-- raw HTML omitted -->.format(err))</p>
<p>audio.stop_stream()
audio.close()
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->import<!-- raw HTML omitted --> <!-- raw HTML omitted -->com.google.protobuf.ByteString<!-- raw HTML omitted -->;</p>
<p><!-- raw HTML omitted -->import<!-- raw HTML omitted --> <!-- raw HTML omitted -->com.cobaltspeech.cubic.CubicGrpc<!-- raw HTML omitted -->;
<!-- raw HTML omitted -->import<!-- raw HTML omitted --> <!-- raw HTML omitted -->com.cobaltspeech.cubic.CubicOuterClass.*<!-- raw HTML omitted -->;</p>
<p><!-- raw HTML omitted -->public<!-- raw HTML omitted --> <!-- raw HTML omitted -->static<!-- raw HTML omitted --> <!-- raw HTML omitted -->void<!-- raw HTML omitted --> <!-- raw HTML omitted -->streamMicrophoneAudio<!-- raw HTML omitted -->() {
<!-- raw HTML omitted -->// Setup connection
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    CubicGrpc.<!-- raw HTML omitted -->CubicStub<!-- raw HTML omitted --> mCubicService = CubicGrpc.<!-- raw HTML omitted -->newStub<!-- raw HTML omitted -->(
ManagedChannelBuilder.<!-- raw HTML omitted -->forTarget<!-- raw HTML omitted -->(url).<!-- raw HTML omitted -->build<!-- raw HTML omitted -->());</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Setup callback to handle results
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    StreamObserver&lt;&gt; responseObserver = <!-- raw HTML omitted -->new<!-- raw HTML omitted --> StreamObserver&lt;RecognitionResponse&gt;() {
<!-- raw HTML omitted -->@Override<!-- raw HTML omitted -->
<!-- raw HTML omitted -->public<!-- raw HTML omitted --> <!-- raw HTML omitted -->void<!-- raw HTML omitted --> <!-- raw HTML omitted -->onNext<!-- raw HTML omitted -->(RecognitionResponse value) {
System.<!-- raw HTML omitted -->out<!-- raw HTML omitted -->.<!-- raw HTML omitted -->println<!-- raw HTML omitted -->(<!-- raw HTML omitted -->&quot;Result: &quot;<!-- raw HTML omitted --> + value.<!-- raw HTML omitted -->toString<!-- raw HTML omitted -->());
}</p>
<pre><code>    &lt;span style=&quot;color:#ffa500&quot;&gt;@Override&lt;/span&gt;
    &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color:#447fcf&quot;&gt;onError&lt;/span&gt;(Throwable t) {
        System.&lt;span style=&quot;color:#bbb&quot;&gt;err&lt;/span&gt;.&lt;span style=&quot;color:#bbb&quot;&gt;println&lt;/span&gt;(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;Error with recognition:&amp;#34;&lt;/span&gt; + t.&lt;span style=&quot;color:#bbb&quot;&gt;toString&lt;/span&gt;());
    }

    &lt;span style=&quot;color:#ffa500&quot;&gt;@Override&lt;/span&gt;
    &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;public&lt;/span&gt; &lt;span style=&quot;color:#6ab825;font-weight:bold&quot;&gt;void&lt;/span&gt; &lt;span style=&quot;color:#447fcf&quot;&gt;onCompleted&lt;/span&gt;() {
        System.&lt;span style=&quot;color:#bbb&quot;&gt;out&lt;/span&gt;.&lt;span style=&quot;color:#bbb&quot;&gt;println&lt;/span&gt;(&lt;span style=&quot;color:#ed9d13&quot;&gt;&amp;#34;Server is done sending responses back&amp;#34;&lt;/span&gt;);
    }
};

&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Setup bidirectional stream
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    StreamObserver&lt;StreamingRecognizeRequest&gt; requestObserver; <!-- raw HTML omitted -->// Outgoing messages are sent on this request object
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    requestObserver = mCubicService.<!-- raw HTML omitted -->streamingRecognize<!-- raw HTML omitted -->(mRecognitionResponseObserver);</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Send config message
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    RecognitionConfig cfg = RecognitionConfig.<!-- raw HTML omitted -->newBuilder<!-- raw HTML omitted -->()
.<!-- raw HTML omitted -->setModelId<!-- raw HTML omitted -->(<!-- raw HTML omitted -->&quot;ModelID&quot;<!-- raw HTML omitted -->)
.<!-- raw HTML omitted -->build<!-- raw HTML omitted -->();
StreamingRecognizeRequest configs = StreamingRecognizeRequest.<!-- raw HTML omitted -->newBuilder<!-- raw HTML omitted -->()
<!-- raw HTML omitted -->// Note, we do not call setAudio here.
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        .<!-- raw HTML omitted -->setConfig<!-- raw HTML omitted -->(cfg)
.<!-- raw HTML omitted -->build<!-- raw HTML omitted -->();
requestObserver.<!-- raw HTML omitted -->onNext<!-- raw HTML omitted -->(configs);</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Setup the Android Micorphone Recorder
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->int<!-- raw HTML omitted --> SAMPLE_RATE = 8000; <!-- raw HTML omitted -->// Same as the model is expecting
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->int<!-- raw HTML omitted --> BUFFER_SIZE = 1024;
AudioRecord recorder = <!-- raw HTML omitted -->new<!-- raw HTML omitted --> AudioRecord(
MediaRecorder.<!-- raw HTML omitted -->AudioSource<!-- raw HTML omitted -->.<!-- raw HTML omitted -->MIC<!-- raw HTML omitted -->,
SAMPLE_RATE,
AudioFormat.<!-- raw HTML omitted -->CHANNEL_IN_MONO<!-- raw HTML omitted -->,
AudioFormat.<!-- raw HTML omitted -->ENCODING_PCM_16BIT<!-- raw HTML omitted -->,
BUFFER_SIZE);
<!-- raw HTML omitted -->byte<!-- raw HTML omitted -->[] audioBuffer = <!-- raw HTML omitted -->new<!-- raw HTML omitted --> <!-- raw HTML omitted -->byte<!-- raw HTML omitted -->[BUFFER_SIZE];
recorder.<!-- raw HTML omitted -->startRecording<!-- raw HTML omitted -->();</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Read the file in chunks and stream to server.
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    <!-- raw HTML omitted -->while<!-- raw HTML omitted --> (running) {
recorder.<!-- raw HTML omitted -->read<!-- raw HTML omitted -->(audioBuffer, 0, BUFFER_SIZE, AudioRecord.<!-- raw HTML omitted -->READ_BLOCKING<!-- raw HTML omitted -->);</p>
<pre><code>    &lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Convert byte[] to ByteString for gRPC
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        ByteString audioBS = ByteString.<!-- raw HTML omitted -->copyFrom<!-- raw HTML omitted -->(audioBuffer);</p>
<pre><code>    &lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Send audio to server
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->        RecognitionAudio audioMsg = RecognitionAudio.<!-- raw HTML omitted -->newBuilder<!-- raw HTML omitted -->()
.<!-- raw HTML omitted -->setData<!-- raw HTML omitted -->(audioBS)
.<!-- raw HTML omitted -->build<!-- raw HTML omitted -->();
requestObserver.<!-- raw HTML omitted -->onNext<!-- raw HTML omitted -->(StreamingRecognizeRequest.<!-- raw HTML omitted -->newBuilder<!-- raw HTML omitted -->()
.<!-- raw HTML omitted -->setAudio<!-- raw HTML omitted -->(audioMsg)
.<!-- raw HTML omitted -->build<!-- raw HTML omitted -->());
}</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Stop the microphone recoding.
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    recorder.<!-- raw HTML omitted -->stop<!-- raw HTML omitted -->();</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Close the client side stream
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->    requestObserver.<!-- raw HTML omitted -->onCompleted<!-- raw HTML omitted -->();</p>
<pre><code>&lt;span style=&quot;color:#999;font-style:italic&quot;&gt;// Note: Once the server is done transcribing everything, it will call responseObserver.onCompleted().
</code></pre>
<p><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->}
<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->

    
    
          <footer class=" footline" >
	
</footer>
  </div>
</div>

<div id="navigation">
<a class="nav nav-prev" href="/sdk-cubic/using-cubic-sdk/recognize/" title="Synchronous Recognition"> <i class="fa fa-chevron-left"></i><label>Synchronous Recognition</label></a>
    <a class="nav nav-next" href="/sdk-cubic/using-cubic-sdk/client-configs/" title="Recognition Configurations" style="margin-right: 0px;"><label>Recognition Configurations</label><i class="fa fa-chevron-right"></i></a></div>

</section>
<div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
  <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
</div>    

<script src="/sdk-cubic/js/clipboard.min.js"></script>
<script src="/sdk-cubic/js/featherlight.min.js"></script>
<script src="/sdk-cubic/js/html5shiv-printshiv.min.js"></script>

<script src="/sdk-cubic/js/modernizr.custom.71422.js"></script>
<script src="/sdk-cubic/js/docdock.js"></script>
<script src="/sdk-cubic/theme-original/script.js"></script>


    

    
    

    
  </body>
</html>